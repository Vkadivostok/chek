<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ß–µ–∫–∞ –Ø–Ω–¥–µ–∫—Å.–¢–∞–∫—Å–∏ (Pro)</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');

        body { 
            font-family: 'Courier Prime', 'Courier New', Courier, monospace; 
            background: #eef2f5; 
            margin: 0; 
            padding: 20px;
            color: #333;
        }
        .main-wrapper {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
            align-items: flex-start;
        }
        
        .controls { 
            flex: 1;
            min-width: 300px;
            padding: 20px; 
            background: #fff; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .preview-area {
            flex: 0 0 380px;
            display: flex;
            justify-content: center;
        }

        #check { 
            width: 100%;
            max-width: 360px;
            background: #fff; 
            padding: 15px 12px 30px 12px; 
            font-size: 12px; 
            font-weight: 700;
            line-height: 1.25;
            color: #000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
            position: relative;
            text-transform: uppercase;
        }

        #check::after {
            content: "";
            position: absolute;
            left: 0;
            bottom: -10px;
            width: 100%;
            height: 10px;
            background: linear-gradient(-45deg, transparent 8px, #fff 0), linear-gradient(45deg, transparent 8px, #fff 0);
            background-size: 16px 16px;
            background-repeat: repeat-x;
        }

        .stars { 
            text-align: center; 
            overflow: hidden; 
            white-space: nowrap; 
            margin: 4px 0; 
            font-weight: normal;
            letter-spacing: -1px;
        }
        
        .center { text-align: center; }
        .right { text-align: right; }
        .bold { font-weight: 700; }
        
        .row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2px;
        }
        
        .qrcode { text-align: center; margin: 12px 0; }
        .qrcode img { width: 130px; height: 130px; display: inline-block; }

        h2 { margin-top: 0; font-size: 20px; color: #444; }
        .group { border: 1px solid #eee; padding: 15px; border-radius: 8px; margin-bottom: 15px; background: #fafafa; }
        .group-title { font-size: 12px; color: #666; margin-bottom: 8px; font-weight: bold; text-transform: uppercase; letter-spacing: 0.5px; }
        
        label { display: block; margin: 8px 0 4px; font-size: 14px; font-weight: 500; }
        input, textarea, select { 
            width: 100%; padding: 10px; font-family: inherit; font-size: 14px; 
            box-sizing: border-box; border-radius: 6px; border: 1px solid #ccc;
        }
        textarea { resize: vertical; min-height: 60px; }
        
        button { 
            width: 100%; padding: 12px; margin-top: 10px; 
            background: #ffdb4d; border: none; border-radius: 6px; 
            font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        button:hover { background: #ffcc00; }
        button.action { background: #28a745; color: white; }
        button.action:hover { background: #218838; }
        
        .btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

        /* –°—Ç–∏–ª—å –ø–æ–¥–≤–∞–ª–∞ –∫–∞–∫ –Ω–∞ —Ñ–æ—Ç–æ */
        .footer-columns {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        .footer-col-left { text-align: left; width: 48%; }
        .footer-col-right { text-align: right; width: 52%; }
        
    </style>
</head>
<body>

<div class="main-wrapper">
    <div class="controls">
        <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ–∫–∞</h2>
        
        <div class="group" style="border-left: 4px solid #ffdb4d;">
            <div class="group-title">üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</div>
            <label>–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —á–µ–∫–∞ –∏–ª–∏ —Å—Å—ã–ª–∫—É:</label>
            <textarea id="importInput" placeholder="https://check.yandex.ru/?n=..."></textarea>
            <button onclick="parseInput()">–†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å</button>
        </div>

        <div class="group">
            <div class="group-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª—è</div>
            <div class="btn-row">
                <div>
                    <label>–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                    <input type="text" id="buyerPhone" value="+79257730256">
                </div>
                <div>
                    <label>Email:</label>
                    <input type="text" id="buyerEmail" value="support@go.yandex.com">
                </div>
            </div>
        </div>

        <div class="group">
            <div class="group-title">–ü–æ–µ–∑–¥–∫–∞</div>
            <div class="btn-row">
                <div>
                    <label>–î–∞—Ç–∞ (–î–î.–ú–ú.–ì–ì –ß–ß:–ú–ú):</label>
                    <input type="text" id="dateTime" value="26.12.25 11:02">
                </div>
                <div>
                    <label>–°—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ):</label>
                    <input type="number" id="price" value="813.00" step="0.01" onchange="updateView()">
                </div>
            </div>
            
            <div class="btn-row">
                <div>
                    <label>–°–º–µ–Ω–∞:</label>
                    <input type="text" id="shift" value="213">
                </div>
                <div>
                    <label>N (–¥–æ–∫/—á–µ–∫):</label>
                    <input type="text" id="checkNum" value="1">
                </div>
            </div>

            <label>–ê–≤—Ç–æ–º–æ–±–∏–ª—å (N ABT):</label>
            <input type="text" id="carInfo" value="whitespirit1h">
            <label>–ò–ù–ù –ü–æ—Å—Ç–∞–≤—â–∏–∫–∞:</label>
            <input type="text" id="agentInn" value="246607850025">
        </div>

        <div class="group">
            <div class="group-title">–§–∏—Å–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</div>
            <label>–§–ù:</label>
            <input type="text" id="fnVal" value="7380440902657068">
            <div class="btn-row">
                <div>
                    <label>–§–î:</label>
                    <input type="text" id="fdVal" value="101261">
                </div>
                <div>
                    <label>–§–ü:</label>
                    <input type="text" id="fpVal" value="3664991491">
                </div>
            </div>
        </div>

        <button class="action" onclick="updateView()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
        <button onclick="downloadImage()">üì∏ –°–∫–∞—á–∞—Ç—å —á–µ–∫ (PNG)</button>
    </div>

    <!-- –û–ë–õ–ê–°–¢–¨ –ü–†–ï–î–ü–†–û–°–ú–û–¢–†–ê -->
    <div class="preview-area">
        <div id="check">
            <div class="stars">********************************</div>
            <div class="center bold">–û–ë–©–ï–°–¢–í–û –° –û–ì–†–ê–ù–ò–ß–ï–ù–ù–û–ô –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨–Æ</div>
            <div class="center bold">"–Ø–ù–î–ï–ö–°.–¢–ê–ö–°–ò"</div>
            <div class="center" style="text-transform: lowercase;">taxi.yandex.ru</div>
            <div class="center" style="margin-top: 2px;">391430, –†–æ—Å—Å–∏—è, –†—è–∑–∞–Ω—Å–∫–∞—è –æ–±–ª., –≥. –°–∞—Å–æ–≤–æ,</div>
            <div class="center">—É–ª. –ü—É—à–∫–∏–Ω–∞, –¥. 21</div>
            <div class="center" style="margin-top: 4px;">–ò–ù–ù: 7704340310</div>
            <div class="stars">********************************</div>
            
            <div class="center bold" style="font-size: 1.4em; margin: 6px 0;">–ö–∞—Å—Å–æ–≤—ã–π —á–µ–∫. –ü—Ä–∏—Ö–æ–¥</div>
            
            <div class="stars">********************************</div>
            
            <div class="row">
                <span>N 11</span>
                <span style="text-transform: none;">N ABT <span id="viewCar"></span></span>
            </div>
            <div class="row">
                <span>–°–º–µ–Ω–∞ N <span id="viewShift"></span></span>
                <span id="viewDate"></span>
            </div>
            
            <div class="stars">********************************</div>
            
            <div class="row">
                <span>N</span>
                <span id="viewCheckNum"></span>
            </div>
            
            <div class="row">
                <span>–ù–∞–∏–º. –ø—Ä.</span>
                <span class="right" style="max-width: 65%;">–ü–µ—Ä–µ–≤–æ–∑–∫–∞ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤ –∏ –±–∞–≥–∞–∂–∞</span>
            </div>
            <div class="row">
                <span>–¶–µ–Ω–∞ –∑–∞ –µ–¥. –ø—Ä.</span>
                <span><span id="viewPriceUnit"></span> ‚ÇΩ</span>
            </div>
            <div class="row">
                <span>–ö–æ–ª–∏—á. –ø—Ä.</span>
                <span>1.000</span>
            </div>
            <div style="margin-top: 2px;">–ù–î–°</div>
            <div class="row">
                <span>–°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä.</span>
                <span><span id="viewTotal2"></span> ‚ÇΩ</span>
            </div>
            <div style="margin-top: 2px;">–ê–ì–ï–ù–¢</div>
            <div class="row">
                <span>–ò–ù–ù –ü–æ—Å—Ç–∞–≤—â–∏–∫–∞</span>
                <span id="viewAgentInn"></span>
            </div>
            <div class="row">
                <span>–ü—Ä–∏–∑–Ω–∞–∫ —Å–ø–æ—Å–æ–±–∞ —Ä–∞—Å—á–µ—Ç–∞</span>
                <span>–ü–û–õ–ù–´–ô –†–ê–°–ß–ï–¢</span>
            </div>
            <div class="row">
                <span>–ò–¢–û–ì–û –±–µ–∑ –ù–î–°</span>
                <span id="viewTotalNoNds"></span>
            </div>
            
            <!-- –ò–¢–û–ì–ò -->
            <div class="row bold" style="font-size: 1.3em; margin-top: 6px;">
                <span>–ò—Ç–æ–≥–æ</span>
                <span><span id="viewTotal"></span> ‚ÇΩ</span>
            </div>
            <div class="row">
                <span>–ë–ï–ó–ù–ê–õ–ò–ß–ù–´–ú–ò</span>
                <span><span id="viewCashless"></span> ‚ÇΩ</span>
            </div>
            
            <div class="stars">********************************</div>
            
            <div class="row"><span>N –ö–ö–¢:</span><span>0000840598005453</span></div>
            <div class="row"><span>N –§–î:</span><span id="viewFd"></span></div>
            <div class="row"><span>N –§–ù:</span><span id="viewFn"></span></div>
            <div class="row"><span>–§–ü:</span><span id="viewFp"></span></div>
            <div class="row"><span>–°–ù–û:</span><span>–û–°–ù</span></div>
            
            <div class="stars">********************************</div>
            
            <div class="qrcode">
                <img id="qrImage" src="" alt="QR">
            </div>
            
            <!-- –ù–û–í–´–ô –ü–û–î–í–ê–õ (2 –ö–û–õ–û–ù–ö–ò + –°–ê–ô–¢ –°–ù–ò–ó–£) -->
             <div class="stars">********************************</div>

             <div class="footer-columns">
                 <div class="footer-col-left">
                     <div>–¢–ï–õ. –ü–û–ö–£–ü–ê–¢–ï–õ–Ø:</div>
                     <div id="viewPhone">+79257730256</div>
                 </div>
                 <div class="footer-col-right">
                     <div>–≠–õ. –ê–î–†. –û–¢–ü–†–ê–í–ò–¢–ï–õ–Ø:</div>
                     <div id="viewEmail" style="text-transform: lowercase;">support@go.yandex.com</div>
                 </div>
             </div>

             <div style="text-align: left;">
                 –°–∞–π—Ç –§–ù–°: <span style="text-transform: lowercase;">www.nalog.gov.ru</span>
             </div>

        </div>
    </div>
</div>

<script>
    window.onload = updateView;

    function parseInput() {
        const input = document.getElementById('importInput').value.trim();
        if (!input) return alert("–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ!");
        let found = false;

        // –ü–æ–∏—Å–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL
        const fnMatch = input.match(/fn=(\d+)/i);
        const fdMatch = input.match(/[?&]i=(\d+)/i) || input.match(/fd=(\d+)/i);
        const fpMatch = input.match(/fp=(\d+)/i);
        const sMatch = input.match(/s=([\d\.]+)/i);
        const tMatch = input.match(/t=(\w+)/i);
        const nMatch = input.match(/n=(\d+)/i);

        if (fnMatch) { document.getElementById('fnVal').value = fnMatch[1]; found = true; }
        if (fpMatch) { document.getElementById('fpVal').value = fpMatch[1]; found = true; }
        if (fdMatch) { document.getElementById('fdVal').value = fdMatch[1]; found = true; }
        if (sMatch) { document.getElementById('price').value = sMatch[1]; found = true; }
        if (nMatch) { document.getElementById('checkNum').value = nMatch[1]; found = true; }

        if (tMatch) {
            const raw = tMatch[1];
            if(raw.length >= 12) {
                const y = raw.substr(2, 2);
                const m = raw.substr(4, 2);
                const d = raw.substr(6, 2);
                const H = raw.substr(9, 2);
                const M = raw.substr(11, 2);
                document.getElementById('dateTime').value = `${d}.${m}.${y} ${H}:${M}`;
                found = true;
            }
        }

        // –ü–æ–∏—Å–∫ –≤ —Ç–µ–∫—Å—Ç–µ
        if(!found) {
           const priceRegex = /–ò–¢–û–ì–û[^\d]*([\d\s]+[.,]\d{2})/i;
           const pM = input.match(priceRegex);
           if(pM) { document.getElementById('price').value = pM[1].replace(/\s/g,'').replace(',','.'); found = true; }
           
           const dateRegex = /(\d{2}\.\d{2}\.\d{2,4}\s+\d{2}:\d{2})/;
           const dM = input.match(dateRegex);
           if(dM) { document.getElementById('dateTime').value = dM[1]; found = true; }
        }

        if (found) {
            updateView();
            alert("–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!");
        } else {
            alert("–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å—Å—ã–ª–∫—É –∏–ª–∏ —Ç–µ–∫—Å—Ç.");
        }
    }

    function updateView() {
        const price = parseFloat(document.getElementById('price').value.replace(',','.') || 0).toFixed(2);
        
        document.getElementById('viewDate').innerText = document.getElementById('dateTime').value;
        document.getElementById('viewShift').innerText = document.getElementById('shift').value;
        document.getElementById('viewCheckNum').innerText = document.getElementById('checkNum').value;
        document.getElementById('viewCar').innerText = document.getElementById('carInfo').value;
        
        document.getElementById('viewPriceUnit').innerText = price;
        document.getElementById('viewTotal2').innerText = price;
        document.getElementById('viewTotal').innerText = price;
        document.getElementById('viewCashless').innerText = price;
        document.getElementById('viewTotalNoNds').innerText = price;
        
        document.getElementById('viewAgentInn').innerText = document.getElementById('agentInn').value;
        document.getElementById('viewFn').innerText = document.getElementById('fnVal').value;
        document.getElementById('viewFd').innerText = document.getElementById('fdVal').value;
        document.getElementById('viewFp').innerText = document.getElementById('fpVal').value;
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ email
        document.getElementById('viewPhone').innerText = document.getElementById('buyerPhone').value;
        document.getElementById('viewEmail').innerText = document.getElementById('buyerEmail').value;

        try {
            const [dPart, tPart] = document.getElementById('dateTime').value.split(' ');
            const [d, m, y] = dPart.split('.');
            const [hr, min] = tPart.split(':');
            const fullYear = (y.length === 2 ? '20' + y : y);
            const qrDate = `${fullYear}${m}${d}T${hr}${min}`;
            
            const qrString = `t=${qrDate}&s=${price}&fn=${document.getElementById('fnVal').value}&i=${document.getElementById('fdVal').value}&fp=${document.getElementById('fpVal').value}&n=1`;
            document.getElementById('qrImage').src = `https://api.qrserver.com/v1/create-qr-code/?size=160x160&margin=0&data=${encodeURIComponent(qrString)}`;
        } catch (e) {}
    }

    function downloadImage() {
        const check = document.getElementById('check');
        html2canvas(check, { scale: 2, useCORS: true, backgroundColor: "#ffffff" }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'check_yandex.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });
    }
</script>

</body>
</html>
